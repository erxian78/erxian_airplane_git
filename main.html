<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="main.css" type="text/css" />
    <title>login_register</title>
</head>
<body>
<header>
    <div></div>
</header>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript">
    $(function(){
        $.get("seat.php", function (data) {
            let allResults = JSON.parse(data);
            let seatResults = JSON.parse(allResults.results);
            let m = 11;
            let n = 7;
            let seatString = "<table border=\"0\"><tr><td width=\"50px\" align=\"center\"></td>";
            for(let i = 0;i < n - 1;i ++)
            {
                seatString += "<td width=\"50px\" align=\"center\">";
                let column = String.fromCharCode(65+i);
                seatString += column;
                seatString += "</td>";
            }
            for(let i = 1;i < m;i ++)
            {
                seatString += "<tr align=\"center\">";
                seatString += "<td width=\"50px\">" + i + "</td>";
                for(let j = 1;j < n;j ++){
                    seatString += "<td width=\"50px\" class='seat' id=" + i + "-" + j + " onclick='reserveSeat(this)'>";
                    seatString += seatResults[(i - 1) * 6 + j - 1];
                    seatString += "</td>";
                }
                seatString += "</tr>";
            }
            seatString += "</table>";
            $("body").append(seatString);
            let infoString = "<p>the total number of seats:&nbsp;" + seatResults.length + "</p>";
            infoString += "<p>the total number of purchased:&nbsp;" + allResults.purchase + "</p>";
            infoString += "<p>the total number of reserved:&nbsp;" + allResults.reserved + "</p>";
            infoString += "<p>the total number of free:&nbsp;" + allResults.free + "</p>";
            $("body").append(infoString);
        });
    });

    reserveSeat = (self) => {
        let row = self.id.split('-')[0];
        let column = self.id.split('-')[1];
        console.log('rorrrr', row, column);
        $.ajax({
            url: "update-seat.php",
            type: 'PUT',
            data: { row: row, column: column, user_id: 1, status: "purchase" },
            success: function (data) {
                console.log("data", data);
                if(data === 'error'){
                    alert("Sorry, this seat has been purchased or reserved by others");
                } else if (data === 'success') {
                    confirm("You have reserve this seat successfully");
                    window.location.href="main.html";
                }
            },
            error: function (error) {
                console.log("data", error);
                confirm("Sorry, system has occured some error");
            }
        });
    }
</script>
</body>
</html>